---
title: SAP BTP - SAP 비즈니스 로직 커스텀하기
published: true
---
우린 앞서 service 파일을 옮김으로서 화면을 바꾸거나 로직을 추가하였다.
이번엔 있던 서비스를 직접 변경해보도록 하자.

cpapp의 srv에 risk-service.js를 추가해보자.
기존은 cds 파일 기반으로 데이터나 ui를 수정했다면 javascript로 로직을 수정

risk의 impact 값이 10000 이하면 정상, 20만 초과면 불가, 10000초과 20만 미만이면 주의
```

const cds = require('@sap/cds')
/**
 * Implementation for Risk Management service defined in ./risk-service.cds
 */
module.exports = cds.service.impl(async function() {
    this.after('READ', 'Risks', risksData => {
        const risks = Array.isArray(risksData) ? risksData : [risksData];
        risks.forEach(risk => {
            if (risk.impact <= 10000) {
                risk.criticality = 0;       //정상
            } else if(risk.impact >= 200000) {
                risk.criticality = 1;       //불가
            } else {
                risk.criticality = 2;       //주의
            }
            
        });
    });
});
```